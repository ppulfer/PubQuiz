@using PubQuiz.Web.Models

<h3 class="mb-4">@Question.Text</h3>

<div class="row">
    @for (int i = 0; i < Question.Options.Count; i++)
    {
        var idx = i;
        <div class="col-6 mb-3">
            <button class="btn @(SelectedOption == idx ? "btn-primary" : "btn-outline-primary") w-100 h-100 py-4"
                    @onclick="() => SelectOption(idx)"
                    disabled="@(HasAnswered || TimeRemaining <= 0)">
                <h4>@((char)('A' + idx))</h4>
                <p class="mb-0">@Question.Options[idx]</p>
            </button>
        </div>
    }
</div>

@if (HasAnswered)
{
    <div class="alert alert-info text-center mt-3">
        Answer submitted! Waiting for results...
    </div>
}
else
{
    <div class="d-grid mt-3">
        <button class="btn btn-success btn-lg"
                @onclick="SubmitAnswer"
                disabled="@(SelectedOption < 0 || TimeRemaining <= 0)">
            Submit Answer
        </button>
    </div>
}

@code {
    [Parameter, EditorRequired] public Question Question { get; set; } = null!;
    [Parameter] public int TimeRemaining { get; set; }
    [Parameter] public bool HasAnswered { get; set; }
    [Parameter] public int SelectedOption { get; set; } = -1;
    [Parameter] public EventCallback<int> OnOptionSelected { get; set; }
    [Parameter] public EventCallback<int> OnAnswerSubmitted { get; set; }

    private async Task SelectOption(int idx)
    {
        if (HasAnswered || TimeRemaining <= 0) return;
        await OnOptionSelected.InvokeAsync(idx);
    }

    private async Task SubmitAnswer()
    {
        if (HasAnswered || SelectedOption < 0 || TimeRemaining <= 0) return;
        await OnAnswerSubmitted.InvokeAsync(SelectedOption);
    }
}
